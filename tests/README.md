# –¢–µ—Å—Ç—ã –¥–ª—è –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–≥–æ –ü–æ–º–æ—â–Ω–∏–∫–∞

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –±–æ—Ç–∞ "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –ü–æ–º–æ—â–Ω–∏–∫". –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é
- –†–∞–±–æ—Ç–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞–º–∏ –∏ –º–µ–Ω—é
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–æ–º–∞–Ω–¥
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API OpenRouter
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ edge cases
- –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py              # –ú–µ—Ç–∫–∞ –ø–∞–∫–µ—Ç–∞
‚îú‚îÄ‚îÄ conftest.py              # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ test_config.py           # –¢–µ—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_keyboards.py        # –¢–µ—Å—Ç—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä –∏ –º–µ–Ω—é
‚îú‚îÄ‚îÄ test_handlers.py         # –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ test_llm_service.py      # –¢–µ—Å—Ç—ã API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_integration.py      # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ README.md               # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –í—Å–µ —Ç–µ—Å—Ç—ã
```bash
pytest
```

### –¢–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã
```bash
pytest -m unit
```

### –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
pytest -m integration
```

### –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
```bash
pytest --cov=src --cov-report=html
```

### –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
```bash
pytest -v
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
```bash
pytest tests/test_config.py::TestConfig::test_validate_config_missing_token
```

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤

### üîß Unit-—Ç–µ—Å—Ç—ã (`unit`)
–¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥—ã:
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- –†–∞–±–æ—Ç–∞ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### üîó Integration-—Ç–µ—Å—Ç—ã (`integration`)
–¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
- –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API
- –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### üì° API-—Ç–µ—Å—Ç—ã (`api`)
–¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- OpenRouter API
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ API
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

### üì± Telegram-—Ç–µ—Å—Ç—ã (`telegram`)
–¢–µ—Å—Ç–∏—Ä—É—é—Ç Telegram-—Å–ø–µ—Ü–∏—Ñ–∏–∫—É:
- –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –∫–æ–ª–±—ç–∫–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥

### ‚è±Ô∏è Slow-—Ç–µ—Å—Ç—ã (`slow`)
–ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

## –§–∏–∫—Å—Ç—É—Ä—ã

### `mock_update`
–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π mock –¥–ª—è Telegram Update –æ–±—ä–µ–∫—Ç–∞ —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏.

### `mock_context`
Mock –¥–ª—è ContextTypes.DEFAULT_TYPE.

### `sample_word`, `sample_phrase`, `sample_text`, `sample_character`
–ü—Ä–∏–º–µ—Ä—ã –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### Unit-—Ç–µ—Å—Ç
```python
@pytest.mark.unit
def test_my_function():
    from my_module import my_function

    result = my_function("test_input")
    assert result == "expected_output"
```

### –¢–µ—Å—Ç —Å –º–æ–∫–∏–Ω–≥–æ–º API
```python
def test_api_call(mock_update):
    mock_response_data = {"choices": [{"message": {"content": "OK"}}]}

    with patch('httpx.post') as mock_post:
        mock_response = MagicMock()
        mock_response.json.return_value = mock_response_data
        mock_post.return_value = mock_response

        with patch.dict('os.environ', {'OPENROUTER_API_KEY': 'test'}):
            from handlers.word_handler import explain_word
            explain_word(mock_update, MagicMock(), "word")

            mock_update.message.reply_text.assert_called()
```

## CI/CD

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ GitHub Actions:

```yaml
- name: Run tests
  run: |
    pip install -r requirements.txt
    pytest --cov --cov-report=xml
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–∞
- ‚úÖ –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ –û—à–∏–±–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `test_*.py`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Ä–∫–µ—Ä—ã `@pytest.mark.*` –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
3. –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –≤ `conftest.py` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `pytest tests/test_*.py`

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
pytest --collect-only

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏
pytest -v -s

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
pytest --tb=short --maxfail=1

# –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è
pytest --cov=handlers --cov-report=html
